### Настройка трекеров

Для того, чтобы активировать использование какого-либо трекера в [emupdate](emupdate), вам нужно включить его плагин в [конфиге](config) и, если потребуется, указать свой логин и пароль для сайта. Кроме того, плагины имеют ряд параметров, таких как прокси и таймауты, которые вы можете настроить индивидуально для каждого трекера. Включение плагина осуществляется добавлением его в секцию `trackers`, как было указано ранее. Параметры передаются внутри секции с именем плагина, например `trackers/rutracker.org/timeout=5.0`.

Представленные ниже параметры доступны для всех трекерных плагинов; рутрекер используется лишь в качестве примера.

* **`trackers/rutracker.org/check_fingerprint=true`**
    * Перед логином на трекер, **emupdate** идет на [гитхаб](https://github.com/mdevaev/emonoda/tree/master/trackers) и проверяет информацию о плагине. В ней содержится кодировка целевого сайта, кусочек текста с его главной страницы (fingerprint) и версия плагина в апстриме. Плагин трекера скачивает главную страницу сайта, а затем ищет в ней подстроку фингерпринта. Если таковой не находится, он делает вывод, что сайт заблокирован провайдером и отказывается работать дальше. Более надежным был бы метод проверки сертификатов, но на данный момент ни один из популярных трекеров не имеет нормально настроенного HTTPS.

* **`trackers/rutracker.org/check_version=true`**
    * Этот параметр почти аналогичен предыдущей, но сравнивает локальную версию плагина с апстримовой. Если в апстриме версия выше, то плагин отказывается работать. Апстримовые версии повышаются только в том случае, если трекер меняет разметку страниц таким образом, что плагины перестают работать, а в апстриме уже есть исправление. Использование этого параметра подсказывает вам, что пора обновить **Emonoda**, чтобы плагин заработал вновь.

* **`trackers/rutracker.org/proxy_url=""`**
    * Позволяет указать прокси для сайта. Поддерживаются HTTP-прокси и SOCKS4/5. Этот параметр можно использовать так: `trackers/rutracker.org/proxy_url=socks5://localhost:5000` (вместе с [SOCKS-проксированием по SSH](https://ru.wikibooks.org/wiki/SSH_%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)). Формат - `scheme://username:passwd@host:port`. Вместо `scheme` нужно указать `socks4`, `socks5` или `http`.

* **`trackers/rutracker.org/retries=20`**
    * Количество повторов при обращении к трекеру при возникновении таймаутов, пятисоток или специфичных для сайта ошибок (например, 404 у рутрекера при скачке торрент-файла не является критической ошибкой, т.к. иногда сайт отдает неправильный бекенд за балансером, и программе нужно просто несколько раз повторить свой запрос).

* **`trackers/rutracker.org/retries_sleep=1.0`**
    * Пауза между повторами при использовании предыдущего параметра.

* **`trackers/rutracker.org/timeout=10.0`**
    * Таймаут на сетевые операции с трекером.

* **`trackers/rutracker.org/user_agent=Mozilla/5.0`**
    * Плагины прикидываются браузером при работе с трекерами. Для некоторых плагинов значение по умолчанию для этого параметра отличается (например, `Googlebot/2.1` для http://rutor.org позволяет обходить DDoS-фильтр CloudFlare).

Некоторые параметры применяются только для неанонимных трекеров, а так же для трекеров, к которым требуется выполнять SCRAPE-запрос. Например, `trackers/nnmclub.to/client_agent`. Здесь приведен полных их список с назначением, а так же таблица, где перечислены использующие их трекеры.

!!! notice
    Плагин nnmclub.to с последних версий теперь тоже использует парсинг времени, а не SCRAPE-запросы. На данный момент ни один плагин не использует SCRAPE, а пример в этой документации оставлен для истории и понимания, что такое вообще бывает.

* **`trackers/rutracker.org/user=""`**
    * Имя пользователя на сайте, обязательно для неанонимных трекеров.

* **`trackers/rutracker.org/passwd=""`**
    * Имя пользователя на сайте, обязательно для неанонимных трекеров.

* **`trackers/nnmclub.to/client_agent=rtorrent/0.9.2/0.13.2`**
    * На некоторых трекерах отсутствует хеш раздачи на странице, но при этом можно выполнить SCRAPE-запрос, чтобы проверить, зарегистрирована ли раздача. Если не зарегистрирована, то это значит, что пора ее обновить. Этот параметр определяет юзерагент для SCRAPE-запросов, чтобы плагин трекера мог прикинуться торрент-клиентом.

* **`trackers/tr.anidub.com/timezone=""`**
    * Если не доступны ни хеш раздачи, ни SCRAPE, то последнее, что остается делать - парсить страницу на предмет времени обновления раздачи. Этот параметр задает таймзону сайта. Обычно плагины определяют ее самостоятельно, заходя под вашим логином на личную страницу с настройками сайта. Такие плагины сравнивают последнее время обновления торрент-файла с новой датой и на основе этого выносят решение о необходимости нового обновления.

***

В таблице ниже дан список всех доступных плагинов и специфичных для них опций:

| Плагин | user, passwd | client_agent | timezone |
|--------|--------------|--------------|----------|
| `rutracker.org` | Обязательно | | |
| `nnm-club.me` | Обязательно | | Опционально |
| `ipv6.nnm-club.name` | Обязательно | | Опционально |
| `rutor.org` | | | |
| `tfile.cc` | Обязательно | | Опционально |
| `pravtor.ru` | Обязательно | | |
| `tr.anidub.com` | Обязательно | | Опционально |
| `pornolab.net` | Обязательно | | Опционально |
| `booktracker.org` | Обязательно | | Опционально |
| `trec.to` | Обязательно | | Опционально |
| `kinozal.tv` | Обязательно | | Опционально |
